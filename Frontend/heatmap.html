<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hotspot Heatmap | Lost & Found AI</title>
  <link rel="stylesheet" href="./style.css" />
  <style>
    .mapwrap{margin-top:14px}
    .campus{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:12px;
      align-items:stretch;
    }
    .zone{
      border-radius:18px;
      padding:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      position:relative;
      overflow:hidden;
      min-height:92px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .zname{font-weight:950; letter-spacing:.2px}
    .zmeta{color:rgba(241,245,255,.75); font-weight:900; margin-top:8px}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top:10px;
      color:rgba(241,245,255,.75);
      font-weight:900;
      flex-wrap:wrap;
    }
    .dot{width:14px;height:14px;border-radius:6px;border:1px solid rgba(255,255,255,.18)}
    .lvl0{background:rgba(255,255,255,.05)}
    .lvl1{background:rgba(80,200,255,.12)}
    .lvl2{background:rgba(80,200,255,.18)}
    .lvl3{background:rgba(255,210,80,.22)}
    .lvl4{background:rgba(255,120,80,.26)}
    .lvl5{background:rgba(255,80,80,.30)}
    .glow{
      position:absolute;
      inset:-40px;
      opacity:.9;
      filter:blur(18px);
      pointer-events:none;
      transform:translateZ(0);
    }

    .b1{grid-column:1 / span 4; grid-row:1}
    .b2{grid-column:5 / span 4; grid-row:1}
    .b3{grid-column:9 / span 4; grid-row:1}

    .library{grid-column:1 / span 5; grid-row:2}
    .cafeteria{grid-column:6 / span 4; grid-row:2}
    .auditorium{grid-column:10 / span 3; grid-row:2}

    .labs{grid-column:1 / span 6; grid-row:3}
    .classrooms{grid-column:7 / span 6; grid-row:3}

    .hostel{grid-column:1 / span 5; grid-row:4}
    .office{grid-column:6 / span 4; grid-row:4}
    .parking{grid-column:10 / span 3; grid-row:4}

    .gate{grid-column:1 / span 4; grid-row:5}
    .bus{grid-column:5 / span 4; grid-row:5}
    .ground{grid-column:9 / span 4; grid-row:5}

    .toplist{display:grid; gap:10px; margin-top:14px}
    .topitem{border-radius:16px;padding:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    @media (max-width: 900px){
      .campus{grid-template-columns:repeat(6,1fr)}
      .b1,.b2,.b3,.library,.cafeteria,.auditorium,.labs,.classrooms,.hostel,.office,.parking,.gate,.bus,.ground{grid-column:auto / span 6}
    }
  </style>
</head>
<body>
  <header class="header">
    <nav class="nav">
      <div class="logo">Lost & Found <span>AI</span></div>
      <ul class="nav-links">
        <li><a href="./index.html">Home</a></li>
        <li><a href="./lost.html">Report Lost</a></li>
        <li><a href="./found.html">Report Found</a></li>
        <li><a href="./ai.html">AI Matching</a></li>
        <li><a href="./heatmap.html">Heatmap</a></li>
      </ul>
      <div class="nav-actions">
        <a class="btn btn-secondary" href="./signin.html">Sign In</a>
      </div>
    </nav>
  </header>

  <div class="container">
    <h1 class="page-title">Campus Hotspot Heatmap</h1>
    <p class="sub">Fixed campus layout. Colors show where reports are concentrated.</p>

    <div class="form">
      <div class="form-actions" style="justify-content:flex-start;">
        <button class="btn btn-primary" type="button" id="refreshHeat">Refresh</button>
      </div>

      <div class="mapwrap">
        <div class="campus" id="campusGrid"></div>

        <div class="badge">
          <span class="dot lvl0"></span>0
          <span class="dot lvl1"></span>Low
          <span class="dot lvl3"></span>Medium
          <span class="dot lvl5"></span>High
        </div>

        <h2 style="text-align:center;margin-top:18px;">Top Hotspots</h2>
        <div id="topList" class="toplist"></div>
      </div>

      <div class="note" style="margin-top:14px;">
        Tip: Use locations like “Library”, “Cafeteria”, “Block”, “Hostel”, “Gate”, “Lab”, “Parking”, “Ground”.
      </div>
    </div>
  </div>

  <footer class="footer">© Lost & Found AI — Smart Recovery System</footer>

  <script src="./script.js"></script>
  <script>
    function lvlClass(count, max){
      if (!max || max <= 0) return "lvl0";
      if (count === 0) return "lvl0";
      const p = count / max;
      if (p <= 0.2) return "lvl1";
      if (p <= 0.4) return "lvl2";
      if (p <= 0.6) return "lvl3";
      if (p <= 0.8) return "lvl4";
      return "lvl5";
    }

    function glowForLevel(lvl){
      const map = {
        lvl0: "rgba(255,255,255,.06)",
        lvl1: "rgba(80,200,255,.22)",
        lvl2: "rgba(80,200,255,.28)",
        lvl3: "rgba(255,210,80,.32)",
        lvl4: "rgba(255,120,80,.36)",
        lvl5: "rgba(255,80,80,.40)"
      };
      return map[lvl] || "rgba(255,255,255,.06)";
    }

    function getCounts(){
      try { return buildHotspotCounts(); } catch { return {}; }
    }

    function renderCampus(){
      const grid = document.getElementById("campusGrid");
      const topList = document.getElementById("topList");
      const counts = getCounts();

      const zones = [
        { key:"Block", label:"Blocks / Corridor", cls:"b1", alt:["Block"] },
        { key:"Classrooms", label:"Classrooms", cls:"b2", alt:["Classrooms"] },
        { key:"Labs", label:"Labs", cls:"b3", alt:["Labs"] },

        { key:"Library", label:"Library", cls:"library", alt:["Library"] },
        { key:"Cafeteria", label:"Cafeteria", cls:"cafeteria", alt:["Cafeteria"] },
        { key:"Auditorium", label:"Auditorium", cls:"auditorium", alt:["Auditorium"] },

        { key:"Labs", label:"Lab Zone", cls:"labs", alt:["Labs"] },
        { key:"Classrooms", label:"Academic Zone", cls:"classrooms", alt:["Classrooms"] },

        { key:"Hostel", label:"Hostel", cls:"hostel", alt:["Hostel"] },
        { key:"Office/Security", label:"Office / Security", cls:"office", alt:["Office/Security"] },
        { key:"Parking", label:"Parking", cls:"parking", alt:["Parking"] },

        { key:"Gate", label:"Main Gate", cls:"gate", alt:["Gate"] },
        { key:"Bus Stop", label:"Bus Stop", cls:"bus", alt:["Bus Stop"] },
        { key:"Ground", label:"Ground", cls:"ground", alt:["Ground"] }
      ];

      const all = Object.values(counts);
      const max = all.length ? Math.max(...all) : 0;

      grid.innerHTML = zones.map(z => {
        const c = counts[z.key] || 0;
        const lvl = lvlClass(c, max);
        const g = glowForLevel(lvl);
        return `
          <div class="zone ${z.cls} ${lvl}">
            <div class="glow" style="background:${g};"></div>
            <div class="zname">${z.label}</div>
            <div class="zmeta">Reports: <b>${c}</b></div>
          </div>
        `;
      }).join("");

      const sorted = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,5);
      if (!sorted.length || max === 0){
        topList.innerHTML = `<div class="topitem"><div>No data yet. Add a few reports to see hotspots.</div></div>`;
        return;
      }
      topList.innerHTML = sorted.map((x,i)=>`
        <div class="topitem">
          <div><b>#${i+1} ${escapeHtml(x[0])}</b></div>
          <div style="color:rgba(241,245,255,.75); font-weight:900;">${x[1]} reports</div>
        </div>
      `).join("");
    }

    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("refreshHeat");
      btn.addEventListener("click", renderCampus);
      renderCampus();
    });
  </script>
</body>
</html>
